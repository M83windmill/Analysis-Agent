# 财报分析助手 Agent

一个基于 LLM 的财报分析 Agent，能够自动检索财报内容、提取关键信息、计算财务指标，并生成带引用的分析报告。

## 项目架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        用户输入                                  │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  A. 接口层 (Interface)                                          │
│  - CLI 命令行界面                                                │
│  - 会话管理 (保存对话历史)                                        │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  D. Agent 决策层 (Orchestration) ★核心                          │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  ReAct 循环                                              │    │
│  │  ┌──────────┐    ┌──────────┐    ┌──────────┐          │    │
│  │  │  思考    │───▶│  行动    │───▶│  观察    │──┐       │    │
│  │  │ Thought  │    │  Action  │    │Observation│  │       │    │
│  │  └──────────┘    └──────────┘    └──────────┘  │       │    │
│  │       ▲                                        │       │    │
│  │       └────────────────────────────────────────┘       │    │
│  └─────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────┘
                              │
                    ┌─────────┴─────────┐
                    ▼                   ▼
┌───────────────────────┐    ┌───────────────────────┐
│  E. 工具层 (Tools)     │    │  C. 知识索引层        │
│  - 检索工具           │◀───│  - Embedding          │
│  - 表格抽取           │    │  - 向量数据库         │
│  - 计算器             │    │  - 检索策略           │
│  - 引用工具           │    └───────────────────────┘
└───────────────────────┘              ▲
                                       │
                    ┌──────────────────┘
                    ▼
┌─────────────────────────────────────────────────────────────────┐
│  B. 文档摄取层 (Ingestion)                                       │
│  - PDF/HTML/TXT 加载                                            │
│  - 文本清洗与切分 (Chunking)                                     │
│  - 元数据标注                                                    │
└─────────────────────────────────────────────────────────────────┘
                              ▲
                              │
┌─────────────────────────────────────────────────────────────────┐
│                        财报文档                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 目录结构

```
Analysis-Agent/
├── README.md                    # 项目说明 (本文件)
├── requirements.txt             # Python 依赖
├── .env.example                 # 环境变量示例
├── main.py                      # 主入口
│
├── docs/                        # 文档
│   ├── LEARNING_PATH.md         # ★学习路径 (从这里开始)
│   ├── QUIZ.md                  # ★自测题 (检验理解)
│   ├── ARCHITECTURE.md          # 架构详解
│   └── INTERVIEW_QA.md          # 面试问答
│
├── src/
│   ├── interface/               # A层: 接口层
│   │   ├── cli.py               # 命令行界面
│   │   └── session.py           # 会话管理
│   │
│   ├── ingestion/               # B层: 文档摄取层
│   │   ├── loader.py            # 文件加载
│   │   ├── extractor.py         # 文本抽取
│   │   └── chunker.py           # 文档切分
│   │
│   ├── index/                   # C层: 知识索引层
│   │   ├── embedder.py          # Embedding生成
│   │   ├── vector_store.py      # 向量数据库
│   │   └── retriever.py         # 检索策略
│   │
│   ├── agent/                   # D层: Agent决策层 ★核心
│   │   ├── simple_agent.py      # 最简Agent (入门)
│   │   ├── orchestrator.py      # 完整Agent循环
│   │   ├── router.py            # 意图路由
│   │   └── planner.py           # 计划生成
│   │
│   ├── tools/                   # E层: 工具层
│   │   ├── base.py              # 工具基类
│   │   ├── retrieval.py         # 检索工具
│   │   ├── table_extract.py     # 表格抽取
│   │   ├── calculator.py        # 财务计算
│   │   └── citation.py          # 引用管理
│   │
│   └── synthesis/               # F层: 生成层
│       ├── evidence.py          # 证据汇总
│       └── answer.py            # 答案生成
│
├── prompts/                     # Prompt 模板
│   ├── system.txt               # 系统提示词
│   └── planning.txt             # 规划提示词
│
├── data/                        # 测试数据
│   └── sample_report.txt        # 示例财报
│
└── tests/                       # 测试
    └── test_agent.py
```

## 快速开始

```bash
# 1. 安装依赖
pip install -r requirements.txt

# 2. 配置环境变量
cp .env.example .env
# 编辑 .env，填入你的 OpenAI API Key

# 3. 运行
python main.py
```

## 学习指南

如果你是来学习 Agent 架构的，请按顺序阅读：

1. **[docs/LEARNING_PATH.md](docs/LEARNING_PATH.md)** - 学习路径和核心概念
2. **src/tools/base.py** - 理解工具定义
3. **src/agent/simple_agent.py** - 最简单的 Agent 实现
4. **src/agent/orchestrator.py** - 完整的 ReAct 循环

## 核心概念

### 什么是 Agent?

```
Agent = LLM + 工具 + 循环决策

普通Chatbot: 用户提问 → LLM回答
Agent:       用户提问 → LLM思考 → 调用工具 → 观察结果 → 继续思考... → 最终回答
```

### 为什么需要 Agent?

1. **能力扩展**: LLM 只会"说"，Agent 能"做"（检索、计算、调用API）
2. **知识增强**: 通过 RAG 访问最新/私有数据
3. **多步推理**: 复杂问题分解为多个步骤执行

## 技术栈

| 组件 | 选择 | 说明 |
|-----|------|------|
| LLM | OpenAI GPT-4 | 主力模型 |
| 向量库 | ChromaDB | 轻量级，本地运行 |
| Embedding | text-embedding-3-small | OpenAI 嵌入模型 |
| PDF处理 | PyMuPDF | 快速稳定 |

## License

MIT
